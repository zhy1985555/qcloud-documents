当用户或运维人员需要对比某个 CDC 任务中 OLTP 与 LibraSQL 分析引擎的数据一致性时，可在 CDC 页面对具体的 CDC 任务创建数据对比并查看对比结果及详情。当对比结果不一致时，提供不一致详情，方便用户或运维人员快速对不一致数据进行处理，保证异构数据的一致性。

仅当 CDC 任务状态为**准备完成**且进度步骤为**同步增量**时支持创建数据对比任务，其他场景均不支持。

## 注意事项
- 数据对比任务不会中断数据同步状态，但可能会增加源数据库实例的负载，因此请在业务低峰期进行操作。
- 在源实例只读情况下，会跳过数据对比。
- 如果在数据对比任务还未结束时，用户选择**终止**CDC 任务，则数据对比任务状态变更为**已终止**。

## 约束限制
- 数据对比的数据表必须具有主键或唯一键，否则不进行数据对比，并在数据对比详情的**未检查内容**区域展示。 
- 数据对比仅对 OLTP 同步到分析引擎的内容进行对比，如果在数据对比过程中进行数据写入，则这部分数据不包含在数据对比范围内。
- 当前数据对比任务对 DDL 操作不感知，如果在数据对比过程中，用户对 OLTP 做了 DDL 操作，数据对比任务可能会报错，需要重新发起数据对比任务才能得到准确的对比结果。 
- 数据对比任务可重复执行，但同一个 CDC 任务在同一时刻仅支持发起一个数据对比任务。
- 数据对比任务创建后不支持编辑和修改。

## 前提条件
已 [添加 CDC](https://cloud.tencent.com/document/product/1488/63678) 任务，状态为**准备完成**且进度步骤为**同步增量**。

## 创建数据对比任务
1. 登录 [TDSQL-H LibraDB 控制台](https://console.cloud.tencent.com/libradb/instance) 。
2. 在实例列表，找到待创建数据对比任务的实例，单击实例 ID 或在**操作**列单击**详情**。
3. 在实例管理页面，单击 **CDC** 页签。
4. 在 CDC 列表找到待创建数据对比任务的 CDC，单击 CDC ID 并选择**数据对比**页签或在**操作**列选择**更多** > **数据对比**。
5. 创建数据对比任务。
  1. 在页面左上方单击**创建数据对比**。
  2. 在弹出的**创建数据对比**对话框中配置参数。
![](https://qcloudimg.tencent-cloud.cn/raw/8434d260d530cc79721cbe35ce75480e.png)
具体配置项说明如下表所示。
<table>
<thead><tr><th>配置项</th><th>说明</th></tr></thead>
<tbody><tr>
<td>任务名称</td><td>自定义任务名称。</td></tr>
<tr>
<td>同步对象模式</td>
<td>无需配置，显示添加 CDC 时设置的对象模式。<br>同步对象模式包括整个实例和指定对象。</td></tr>
<tr>
<td>对比对象</td>
<td>请选择全部同步对象或自定义选择对象。</td></tr>
</tbody></table>
  3. 阅读并勾选**已知悉**，单击**启动数据对比**。
  4. 根据界面提示，查看创建数据对比任务是否成功。
    - 是，进入数据对比任务列表，创建的数据对比任务状态为**等待运行**，继续等待，当**任务状态**变更为**成功**时，表明数据对比任务创建成功。
    - 否，弹出**创建对比任务失败**对话框，并提示错误码、错误原因和 Request Id，请根据错误提示信息处理后重新创建数据对比任务。

## 查看数据对比结果
1. 在数据对比页面，查看数据对比任务列表。
![](https://qcloudimg.tencent-cloud.cn/raw/431cb4dc6d2e67beb1b0d67bdffe8d49.png)
关键参数说明如下表所示。
<table>
<thead><tr><th>参数</th><th>说明</th></tr></thead>
<tbody><tr>
<td>任务 ID</td><td>数据对比任务全局唯一 ID。</td></tr>
<tr>
<td>对比结果</td>
<td>数据对比结果包括一致、不一致、--。<br>若显示--，表示对比中或任务被终止无对比结果。</td></tr>
<tr>
<td>任务状态</td>
<td>任务状态包括创建完成、等待运行、运行中、成功、失败、结束中、已终止。</td></tr>
<tr>
<td>操作</td>
<td>支持以下操作：<ul><li>查看对比结果详情：请单击<strong>查看</strong>。</li><li>终止任务状态为<strong>等待运行</strong>或<strong>运行中</strong>的任务：请单击<strong>终止</strong>。</li><li>启动任务状态为<strong>创建完成</strong>的任务：请单击<strong>启动</strong>。</li></ul></td></tr>
</tbody></table>
2. 找到待查看的任务，单击任务 ID 或在**操作**列单击**查看**。
3. 在任务详情页面查看具体对比结果详情。具体示例如下所示。
  - 对比结果一致示例
<img src="https://qcloudimg.tencent-cloud.cn/raw/b54231e37fd788080c724724831b3539.png"  style="zoom:50%;">
  - 对比结果不一致示例
<img src="https://qcloudimg.tencent-cloud.cn/raw/fa1cd0bbda00e34bf0409ee62ba3bf33.png"  style="zoom:50%;">

