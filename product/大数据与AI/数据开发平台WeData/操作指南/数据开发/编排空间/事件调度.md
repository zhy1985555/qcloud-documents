## 事件调度概览
腾讯云 WeData 编排空间支持事件触发调度功能，用户在工作流任务上配置事件依赖后，该任务将等待事件达到后方可执行。 

## 事件调度原理
![](https://qcloudimg.tencent-cloud.cn/raw/0f665b30783ef696f0a748d5da399261.png)
- 任务 A 和 B 未配置事件监听时，任务 A 实例的调度时间达到后即可运行，任务 B 实例需调度时间达到且上游任务 A 实例运行成功后，才可运行。
- 任务 A 和 B 配置事件监听时，任务 A 和任务 B 除了上述条件外，还需要监听的事件到达后，方可运行。

## 事件调度流程概览
事件调度整体由触发程序、触发事件和监听任务组成，首先在项目下需要根据业务定义触发事件，然后编写触发程序发送事件，监听任务监听到事件触达后即可运行。

## 触发程序
触发程序支持触发 shell 方式。
- 触发 Shell，即配置了“事件驱动 hook”的 shell，可在任务调度设置里面配置，其中事件变量为触发事件的关键字，在触发 shell 中会用到，当触发 shell 执行成功后，平台会基于 shell 输出的日志搜索事件变量关键字，匹配后再调用触发接口，触发 shell 支持一次性触发多个事件，多个事件之间用“;”分隔，下图所示，事件变量配置为 triggertask，则在 shell 中 echo 的变量应该为 triggertask，下图中 DemoEventByShell 为触发事件名，2021-03-12为事件对应的数据时间。
![](https://qcloudimg.tencent-cloud.cn/raw/64f3935c2f122fd52ca2f5b92ecfe052.png)
当触发多个事件时，shell 脚本可如此设置： echo triggertask=”EventA，2021-12-09；EventB，2021-12-12“

## 触发事件
在使用事件调度之前需要定义事件，点击事件管理图标，打开事件管理列表页，支持查看、新建、批量导入/导出、一键导出事件等操作，如下图：
![](https://qcloudimg.tencent-cloud.cn/raw/a0b46da2c67e2628fcb8a5f130861f2c.png)

| 参数 | 说明 | 
|---------|---------|
| <nobr>事件名称	| 用户基于业务需求定义的消息，用于触发任务实例执行，一个事件可支持触发多个任务实例运行，例如针对 UDP 场景一个表对应一个事件| 
| 周期类型	| 与监听事件的周期类型对应，事件实例和任务实例的数据时间相同时方能触发| 
| 有效时间	| 事件最大的存活时间，逾期将自动销毁| 
| 广播类型	| 支持单播和广播，单播表示事件与任务关系为1对1，一个事件实例仅被一个任务实例消费，广播配置下，一个事件实例可被多个任务实例消费| 

## 监听事件
工作流任务在调度设置中可以配置监听事件，如下：
![](https://qcloudimg.tencent-cloud.cn/raw/625208616b8208b8ec1b9932351cb2bc.png)

## 事件消费
在任务运维的**事件触发实例**可以查看事件实例的消费情况。
![](https://qcloudimg.tencent-cloud.cn/raw/aa0b3a606251a0876c940b7776c84077.png)
